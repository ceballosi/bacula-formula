#
# Bacula Director Configuration file
# This file is managed by Saltstack, do not edit!
# For documentation on configuring the director
# have a look in the director configuration page -
# http://www.bacula.org/7.2.x-manuals/en/main/Configuring_Director.html
#

#
# Definition of the director
#

Director {                            # define myself
  Name = {{ director_name }}
  DIRport = 9101                # where we listen for UA connections
  QueryFile = "/etc/bacula/scripts/query.sql"
  WorkingDirectory = "{{ working_directory }}"
  PidDirectory = "/var/run/bacula"
  Maximum Concurrent Jobs = {{ max_concurrent }}
  Password = "{{ password }}"         # Console password
  Messages = Daemon
}

#
# Definition of the catalog
#

Catalog {
  Name = {{ catalog }}
  dbname = "{{ dbname }}"
  dbaddress = "{{ dbhost }}"
  dbuser = "{{ dbuser }}"
  dbpassword = "{{ dbpassword }}"
}

#
# Job message delivery. Removed all email messages, as just logging to a
# log file should be sufficient for our needs. Especially as we'll ship the
# log file to logstash.
#

Messages {
  Name = Standard
  console = all, !skipped, !saved
#
# WARNING! the following will create a file that you must cycle from
#          time to time as it will grow indefinitely. However, it will
#          also keep all your messages if they scroll off the console.
#
  append = "/var/log/bacula/bacula.log" = all, !skipped
  catalog = all
}


#
# Message delivery for daemon messages (no job).
# Again, removed all email messages.
#

Messages {
  Name = Daemon
  console = all, !skipped, !saved
  append = "/var/log/bacula/bacula.log" = all, !skipped
}

#
# Default pool definition
#

Pool {
  Name = Default
  Pool Type = Backup
  Recycle = yes                       # Bacula can automatically recycle Volumes
  AutoPrune = yes                     # Prune expired volumes
  Volume Retention = 1 year           # one year
  Maximum Volume Jobs = 1                 # create a new volume for each job
  Label Format = "${Job}-${Level}-${JobId}"
}

{%- if monitor_password %}
#
# Restricted console used by tray-monitor to get the status of the director
#

Console {
  Name = localhost-mon
  Password = "{{ monitor_password }}"
  CommandACL = status, .status
}
{%- endif %}

#
# Include additional director configuration files
#

# Pool definitions pulled from pillar
@/etc/bacula/bacula-dir-pools.conf

# Default schedules
@/etc/bacula/bacula-dir-schedules-defaults.conf

# Schedules pulled from pillar
@/etc/bacula/bacula-dir-schedules.conf

# Clients pulled from pillar
@/etc/bacula/bacula-dir-clients.conf

# File sets pulled from pillar
@/etc/bacula/bacula-dir-filesets.conf

# Job definitions pulled from pillar
@/etc/bacula/bacula-dir-jobdefs.conf

# Jobs pulled from pillar
@/etc/bacula/bacula-dir-jobs.conf

# Storage daemons pulled from pillar
@/etc/bacula/bacula-dir-storage.conf
